services:
  registry:
    image: registry:3
    container_name: registry
    restart: always
    environment:
      # Storage configuration
      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /var/lib/registry
      # Enable deletion of images
      REGISTRY_STORAGE_DELETE_ENABLED: "true"
      # HTTP configuration
      REGISTRY_HTTP_ADDR: 0.0.0.0:5000
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Origin: "['*']"
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Methods: "['HEAD','GET','OPTIONS','DELETE']"
      REGISTRY_HTTP_HEADERS_Access-Control-Allow-Headers: "['Authorization','Accept','Cache-Control']"
    volumes:
      - ./data:/var/lib/registry
    ports:
      - "5000:5000"
    labels:
      - traefik.enable=true
      - traefik.http.routers.dock.rule=Host(`dock.$HOST`)
      - traefik.http.routers.dock.entrypoints=http
      - traefik.http.services.dock.loadbalancer.server.port=5000
